<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AI‚ÄëCall ‚Äî Connect with AI on Calls</title>
    <link rel="stylesheet" href="/global.css" />
    <style>
      .container{ max-width:1120px; margin:0 auto; padding:32px 24px; }
      .nav{ display:flex; align-items:center; justify-content:space-between; }
      .brand{ display:flex; align-items:center; gap:12px; font-weight:700; font-size:22px; }
      .brand img{ width:36px; height:36px; object-fit:contain; filter: drop-shadow(0 4px 12px rgba(0,0,0,.25)); }
      .nav a{ color:var(--muted); text-decoration:none; margin-left:24px; font-weight:600; }
      .nav a:hover{ color:white }
      .container{ max-width:1120px; margin:0 auto; padding:32px 24px; }
      .nav{ display:flex; align-items:center; justify-content:space-between; }
      .brand{ display:flex; align-items:center; gap:12px; font-weight:700; font-size:22px; }
      .brand img{ width:36px; height:36px; object-fit:contain; filter: drop-shadow(0 4px 12px rgba(0,0,0,.25)); }
      .nav a{ color:var(--muted); text-decoration:none; margin-left:24px; font-weight:600; }
      .nav a:hover{ color:white }

      .hero{ display:grid; grid-template-columns: 1.05fr .95fr; gap:48px; padding:64px 0 24px; align-items:center; }
      .title{ font-size:56px; line-height:1.05; margin:0 0 16px; letter-spacing:-0.5px; }
      .subtitle{ color:var(--muted); font-size:18px; max-width:560px; }
      .cta{ display:inline-block; margin-top:28px; background:var(--btn); color:#1b0033; font-weight:800; border:none; padding:14px 22px; border-radius:14px; box-shadow:0 10px 30px rgba(255,110,169,.35); cursor:pointer; text-decoration:none }
      .cta:hover{ transform: translateY(-1px); box-shadow:0 14px 40px rgba(255,110,169,.45); }

      .phone{ position:relative; display:flex; align-items:center; justify-content:center; }
      .mock{ width:88%; border-radius:28px; padding:24px; background:linear-gradient(160deg, rgba(255,255,255,.12), rgba(255,255,255,.04)); box-shadow: inset 0 0 0 1px rgba(255,255,255,.15), 0 20px 60px rgba(0,0,0,.25); }
      .mock img{ width:100%; height:auto; display:block; }

      .features{ display:grid; grid-template-columns: repeat(3, 1fr); gap:18px; margin:64px 0 48px; }
      .card{ background:var(--card-bg); backdrop-filter: blur(8px); border-radius:18px; padding:20px; box-shadow: inset 0 0 0 1px rgba(255,255,255,.08), 0 10px 30px rgba(0,0,0,.18); }
      .card h3{ margin:12px 0 8px; font-size:18px }
      .card p{ margin:0; color:var(--muted); line-height:1.6 }
      .card .icon{ width:44px; height:44px; border-radius:12px; display:grid; place-items:center; background:linear-gradient(135deg, rgba(255,255,255,.35), rgba(255,255,255,.05)); }

      .footer{ color:#d9d9e6; opacity:.9; padding:32px 0 48px; font-size:14px }
      .footer a{ color:white; text-decoration:none }

      @media (max-width: 920px){
        .hero{ grid-template-columns: 1fr; }
        .title{ font-size:44px }
        .features{ grid-template-columns: 1fr; }
      }
    </style>
  </head>
  <body>
    <header class="container">
      <nav class="nav">
        <div class="brand">
          <img src="/assets/logo.png" alt="AI‚ÄëCall Logo"/>
          <span>AI‚ÄëCall</span>
        </div>
        <div class="links">
          <a href="#">Home</a>
          <a href="#features">Features</a>
          <a href="/call.html">Try</a>
          <a href="#contact">Contact</a>
        </div>
      </nav>
    </header>

    <main class="container">
      <section class="hero">
        <div>
          <h1 class="title">Connect with <br/>AI on Calls</h1>
          <p class="subtitle">–ü–æ–≤—ã—Å—å—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–π—Ç–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã —Å –ø–æ–º–æ—â—å—é AI‚Äë–ø–æ–º–æ—â–Ω–∏–∫–∞. –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∞—É–¥–∏–æ, –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è —Å–≤—è–∑—å, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.</p>
          <a class="cta" href="#try">Get Started</a>
        </div>
        <div class="phone">
          <div class="mock">
            <img src="/assets/item.png" alt="Assistant mock"/>
          </div>
        </div>
      </section>

      <section id="features" class="features">
        <div class="card">
          <div class="icon">üìû</div>
          <h3>AI‚ÄëPowered</h3>
          <p>–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∑–≤–æ–Ω–∫–æ–≤, –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∏ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä—É –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.</p>
        </div>
        <div class="card">
          <div class="icon">üîä</div>
          <h3>Voice Recognition</h3>
          <p>–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤.</p>
        </div>
        <div class="card">
          <div class="icon">üéß</div>
          <h3>Live Support</h3>
          <p>–ù–∞–¥—ë–∂–Ω—ã–µ –∞—É–¥–∏–æ–∑–≤–æ–Ω–∫–∏ —Å –Ω–∏–∑–∫–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π. –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å.</p>
        </div>
      </section>

      <section id="try" class="card" style="padding:24px;">
        <h2 style="margin:0 0 8px;">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∑–≤–æ–Ω–æ–∫</h2>
        <p class="subtitle" style="margin:0 0 12px;">–û—Ç–∫—Ä–æ–π—Ç–µ —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ –¥–≤—É—Ö –≤–∫–ª–∞–¥–∫–∞—Ö, –≤–≤–µ–¥–∏—Ç–µ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π Room ID –∏ –Ω–∞–∂–º–∏—Ç–µ Join.</p>
        <div style="display:flex; gap:12px; flex-wrap:wrap; align-items:center;">
          <label>Room ID <input id="room" value="test-room" style="padding:10px 12px; border-radius:10px; border:none; outline:none;"/></label>
          <button id="join" class="cta" style="margin:0;">Join</button>
          <button id="leave" class="cta" style="margin:0; background:#fff; color:#12002b; box-shadow:none; opacity:.9;" disabled>Leave</button>
        </div>
        <pre id="log" style="margin-top:12px; background:rgba(0,0,0,.25);"></pre>
      </section>
    </main>

    <footer class="container footer" id="contact">
      <span>¬© AI‚ÄëCall. All rights reserved.</span>
    </footer>

    <script>
      const logEl = document.getElementById('log');
      const roomEl = document.getElementById('room');
      const joinBtn = document.getElementById('join');
      const leaveBtn = document.getElementById('leave');

      let ws; let clientId; let roomId; let pc; let localStream; let peers = [];

      function log(...args) {
        const line = args.map(x => typeof x === 'string' ? x : JSON.stringify(x)).join(' ');
        logEl.textContent += line + '\n'; logEl.scrollTop = logEl.scrollHeight;
        console.log(...args);
      }

      async function initMedia() {
        localStream = await navigator.mediaDevices.getUserMedia({ audio: true, video: false });
      }

      function createPc() {
        pc = new RTCPeerConnection({
          iceServers: [
            { urls: ['stun:stun.l.google.com:19302'] },
            { urls: ['turn:ai-call.24ai-spbconsult.ru:3478'], username: 'aiuser', credential: 'supersecretpassword' }
          ]
        });
        pc.onicecandidate = (e) => {
          if (e.candidate && peers[0]) {
            ws.send(JSON.stringify({ type: 'signal', roomId, targetId: peers[0], payload: { candidate: e.candidate } }));
          }
        };
        pc.ontrack = (e) => {
          let el = document.getElementById('remote');
          if (!el) {
            el = document.createElement('audio');
            el.id = 'remote'; el.autoplay = true; el.controls = true;
            document.body.appendChild(el);
          }
          el.srcObject = e.streams[0];
        };
        for (const track of localStream.getAudioTracks()) {
          pc.addTrack(track, localStream);
        }
      }

      async function call() {
        if (!peers[0]) return;
        createPc();
        const offer = await pc.createOffer({ offerToReceiveAudio: true });
        await pc.setLocalDescription(offer);
        ws.send(JSON.stringify({ type: 'signal', roomId, targetId: peers[0], payload: { sdp: pc.localDescription } }));
      }

      async function handleSignal(fromId, payload) {
        if (payload.sdp) {
          if (!pc) createPc();
          const desc = payload.sdp;
          if (desc.type === 'offer') {
            await pc.setRemoteDescription(desc);
            const answer = await pc.createAnswer();
            await pc.setLocalDescription(answer);
            ws.send(JSON.stringify({ type: 'signal', roomId, targetId: fromId, payload: { sdp: pc.localDescription } }));
          } else if (desc.type === 'answer') {
            await pc.setRemoteDescription(desc);
          }
        } else if (payload.candidate) {
          if (!pc) return;
          try { await pc.addIceCandidate(payload.candidate); } catch (e) { log('ICE add error', e); }
        }
      }

      joinBtn.onclick = async () => {
        roomId = roomEl.value.trim();
        if (!roomId) return;
        await initMedia();
        ws = new WebSocket((location.protocol === 'https:' ? 'wss://' : 'ws://') + location.host + '/ws');
        ws.onmessage = async (e) => {
          const msg = JSON.parse(e.data);
          if (msg.type === 'welcome') { clientId = msg.clientId; log('id', clientId); }
          if (msg.type === 'peers') {
            peers = msg.peers;
            log('peers', peers);
            if (peers.length > 0 && !pc) {
              await call();
            }
          }
          if (msg.type === 'signal') {
            await handleSignal(msg.fromId, msg.payload);
          }
          if (msg.type === 'error') { log('error', msg.message); }
        };
        ws.onopen = () => ws.send(JSON.stringify({ type: 'join', roomId }));
        ws.onclose = () => { log('socket closed'); };
        joinBtn.disabled = true; leaveBtn.disabled = false; roomEl.disabled = true;
      };

      leaveBtn.onclick = () => {
        try { ws && ws.send(JSON.stringify({ type: 'leave', roomId })); } catch {}
        try { ws && ws.close(); } catch {}
        try { pc && pc.close(); } catch {}
        pc = null; peers = []; clientId = null; roomId = null;
        joinBtn.disabled = false; leaveBtn.disabled = true; roomEl.disabled = false;
      };
    </script>
  </body>
  </html>


